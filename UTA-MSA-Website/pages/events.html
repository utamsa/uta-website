<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MSA UT Arlington — Events</title>
  
  <!-- 🟦 Favicons -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" href="/favicon-512x512.png" sizes="512x512" type="image/png">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="apple-touch-icon" href="../assets/apple-touch-icon.png">

  <!-- 🟨 Web App Manifest -->
  <link rel="manifest" href="../assets/site.webmanifest">

  <!-- 🟥 Theme Colors -->
  <meta name="theme-color" content="#ffffff">
  <meta name="background-color" content="#ffffff">

  <!-- Theme + fragments -->
  <link rel="stylesheet" href="../css/navbar.css" />
  <link rel="stylesheet" href="../css/footer.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <link rel="stylesheet" href="../css/events.css" />
  <!-- Page-specific styles ---> 
  <style>
    .calendar {
      width: min(1200px, 92vw);
      margin: 18px auto 0;
      padding: 0 0 24px;
    }

    .view-toggle {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
      margin: 0 0 14px;
    }

    .toggle-btn {
      appearance: none;
      border: 1px solid rgba(18, 60, 102, .15);
      background: #f1f5f9;
      color: #123c66;
      cursor: pointer;
      padding: 10px 14px;
      border-radius: 12px;
      font-weight: 700;
      transition: transform .12s ease, background .2s ease, color .2s ease, border-color .2s ease, box-shadow .2s ease;
    }

    .toggle-btn:hover {
      transform: translateY(-1px);
    }

    .toggle-btn.active {
      background: linear-gradient(90deg, #123c66, #ef7d1a);
      color: #fff;
      border-color: transparent;
      box-shadow: 0 10px 22px rgba(18, 60, 102, .18);
    }

    .cal-wrap {
      position: relative;
      width: 100%;
      height: clamp(520px, 76vh, 960px);
      background: #fff;
      border: 1px solid rgba(12, 16, 22, .08);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 16px 40px rgba(0, 0, 0, .10);
    }

    .cal-wrap iframe {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: 0;
    }

    .cal-note {
      color: #475569;
      font-size: .95rem;
      margin: .75rem 2px 0;
    }

    /* Quick-links & highlights */
    .quick-links {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .highlights {
      width: min(1200px, 92vw);
      margin-inline: auto;
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(3, 1fr);
    }

    .card {
      background: #fff;
      border: 1px solid rgba(12, 16, 22, .08);
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 10px 24px rgba(0, 0, 0, .06);
    }

    .card h3 {
      margin: 4px 0 6px;
      color: #123c66;
      font-size: 1.15rem;
    }

    .card p {
      margin: 0;
      color: #334155;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      color: #0c1016;
    }

    .badge i {
      color: #ef7d1a;
    }

    @media (max-width:900px) {
      .highlights {
        grid-template-columns: 1fr;
      }
    }

    /* Upcoming events */
    .upcoming-grid {
      display: grid;
      gap: 24px;
      grid-template-columns: 1fr;
      margin-top: 20px;
    }

    .event-card {
      background: #fff;
      border: 1px solid rgba(12, 16, 22, .08);
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 10px 24px rgba(0, 0, 0, .06);
      text-align: center;
    }

    .event-flyer {
      width: 100%;
      border-radius: 12px;
      margin-bottom: 12px;
    }

    .event-title {
      font-size: 1.2rem;
      color: #123c66;
      margin: 8px 0 4px;
    }

    .event-date {
      color: #334155;
      margin: 0 0 12px;
    }

    .hidden {
      display: none;
    }

    /* Mobile RSVP button improvements */
    @media (max-width: 640px) {
      .rsvp-btn {
        min-height: 44px; /* iOS touch target minimum */
        min-width: 44px;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
      }
      
      .rsvp-form {
        margin-top: 16px;
        padding: 16px;
        background: #f8fafc;
        border-radius: 12px;
        border: 1px solid rgba(18, 60, 102, 0.1);
        width: 100%;
        overflow-x: auto; /* Allow horizontal scroll if form is too wide */
        display: block !important; /* Force display when not hidden */
      }
      
      .rsvp-form.hidden {
        display: none !important; /* Force hide when hidden */
      }
      
      /* Ensure CustomGForm elements are mobile-friendly */
      .rsvp-form [data-customgform] {
        width: 100%;
        min-width: 280px; /* Minimum width for form elements */
        display: block !important;
        min-height: 200px; /* Ensure minimum height */
      }
      
      /* CustomGForm iframe mobile fixes */
      .rsvp-form iframe {
        width: 100% !important;
        min-height: 200px !important;
        border: none !important;
        display: block !important;
      }
      
      /* CustomGForm form mobile fixes */
      .rsvp-form form {
        width: 100% !important;
        display: block !important;
      }
      
      /* CustomGForm input containers */
      .rsvp-form .form-group,
      .rsvp-form .field {
        width: 100% !important;
        margin-bottom: 16px !important;
        display: block !important;
      }
      
      /* Mobile form input styling */
      .rsvp-form input,
      .rsvp-form textarea,
      .rsvp-form select {
        font-size: 16px; /* Prevents zoom on iOS */
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #d1d5db;
        width: 100%;
        box-sizing: border-box;
      }
      
      .rsvp-form button {
        min-height: 44px;
        font-size: 16px;
        padding: 12px 24px;
      }
    }
  </style>
</head>

<body>
  <!-- Navbar fragment -->
  <div data-include="./fragments/navBar.html"></div>

  <!-- HERO -->
  <section id="hero" class="section hero">
    <div class="hero-wrap">
      <p class="eyebrow">Stay Connected</p>
      <h1 class="title">Explore our <span>events, programs,</span> and <span>calendar</span>.</h1>
      <p class="subhead">
        From Jumu’ah to socials, study circles, and service projects — stay in the loop with everything happening at MSA
        UTA.
      </p>

      <div class="hero-actions">
        <a class="btn btn-primary" href="#upcoming">Upcoming Events</a>
        <a class="btn btn-ghost" href="#calendar-section">View Calendar</a>
      </div>
    </div>
  </section>


  <!-- UPCOMING EVENTS -->
  <section id="upcoming" class="section alt">
    <div class="container">
      <h2 class="section-title center">Upcoming Events</h2>
      <p class="muted tiny center">Check out what’s coming up soon.</p>

      <div class="upcoming-grid">

        <!-- A Night of Sumud -->
        <article class="event-card">
          <img src="../assets/events/finale.PNG" alt="A Night of Sumud – Watermelon Week Finale Flyer"
            class="event-flyer" />
          <h3 class="event-title">A Night of Sumud – Watermelon Week Finale</h3>
          <p class="event-date">
            Friday, October 10 • 5:30 PM • CAPPA Courtyard
          </p>
          <p class="muted tiny">$10 entry fee • Dinner provided</p>

          <!-- RSVP -->
          <button class="btn btn-primary rsvp-btn">RSVP Now</button>
          <div class="rsvp-form hidden">
            <div data-customgform="cmgim4ur100u7wnkx1ldfhvf4"></div>
          </div>
        </article>

        <!-- Blueprint Flyer -->
        <article class="event-card">
          <img src="../assets/events/Blueprint.png" alt="The Blueprint Flyer" class="event-flyer" />
          <h3 class="event-title">The Blueprint</h3>
          <p class="event-date">
            Tuesdays • 5:30 PM – Location: SEIR 294
          </p>

          <!-- RSVP (commented out)
          <button class="btn btn-primary rsvp-btn">RSVP Now</button>
          <div class="rsvp-form hidden">
           <div data-customgform="cmf61ic8j00auwnknpxyquaxs"></div>
          </div>
            -->
        </article>

        <!-- Listeners Corner Flyer -->
        <article class="event-card">
          <img src="../assets/events/listeners-corner-flyer.png" alt="Listeners Corner Flyer" class="event-flyer" />
          <h3 class="event-title">Listeners Corner</h3>
          <p class="event-date">
            Wednesdays • Starting Sept. 24 • 11:30 AM • In front of the UC
          </p>

          <!-- RSVP (commented out)
          <button class="btn btn-primary rsvp-btn">RSVP Now</button>
          <div class="rsvp-form hidden">
         <div data-customgform="listeners-corner"></div>
          </div>
           -->
        </article>

      </div>

    </div>
  </section>



  <!-- HIGHLIGHTS -->
  <section id="highlights" class="section">
    <div class="container">
      <h2 class="section-title center">Highlights</h2>
      <div class="highlights">
        <article class="card">
          <div class="badge"><i class="fa-solid fa-mosque"></i> Jumu’ah on Campus</div>
          <h3>Every Friday • 1:30 PM</h3>
          <p>Join us for Jumu’ah in the UTA Musallah. Come a bit early to find a spot and meet the community!</p>
        </article>
        <article class="card">
          <div class="badge"><i class="fa-solid fa-book-quran"></i> Study Circles</div>
          <h3>Weekly • Evenings</h3>
          <p>Interactive halaqas covering faith, character, and seerah. All levels welcome—bring a friend.</p>
        </article>
        <article class="card">
          <div class="badge"><i class="fa-solid fa-hand-holding-heart"></i> Service Projects</div>
          <h3>Monthly • Weekends</h3>
          <p>Volunteer with us around DFW—food drives, campus cleanups, and collaborative initiatives.</p>
        </article>
      </div>
    </div>
  </section>

  <!-- CALENDAR -->
  <section id="calendar-section" class="section alt">
    <div class="container">
      <h2 class="section-title center">Calendar</h2>
      <p class="muted tiny center">Fast access to our calendar and event resources.</p>

      <!-- Quick Links above calendar -->
      <div class="quick-links" style="margin:16px 0">
        <a class="btn btn-primary" href="#calendar"><i class="fa-regular fa-calendar"></i> View Calendar</a>
        <a class="btn btn-ghost"
          href="https://calendar.google.com/calendar/u/0?cid=3829b628fb7826ae1317e90d0ceb01a699861ca1339348da612a20174cca3db7@group.calendar.google.com"
          target="_blank" rel="noopener"><i class="fa-solid fa-plus"></i> Subscribe</a>
        <a class="btn btn-ghost"
          href="https://calendar.google.com/calendar/ical/3829b628fb7826ae1317e90d0ceb01a699861ca1339348da612a20174cca3db7%40group.calendar.google.com/public/basic.ics"
          target="_blank" rel="noopener"><i class="fa-solid fa-file-arrow-down"></i> Download .ics</a>
      </div>

      <main id="calendar" class="calendar" role="main" aria-label="UTA MSA Calendar">
        <div class="view-toggle" role="tablist" aria-label="Calendar view">
          <button class="toggle-btn active" data-mode="MONTH" role="tab" aria-selected="true">Month</button>
          <button class="toggle-btn" data-mode="WEEK" role="tab" aria-selected="false">Week</button>
          <button class="toggle-btn" data-mode="AGENDA" role="tab" aria-selected="false">Agenda</button>
        </div>

        <div class="cal-wrap">
          <iframe id="gcal-frame" title="UTA MSA Events Calendar" loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"></iframe>
        </div>

        <p class="cal-note">
          Times are shown in Central Time (America/Chicago). Tap any event for details or to add it to your own
          calendar.
        </p>
      </main>
    </div>
  </section>

  <!-- FAQ -->
  <section id="faq" class="section alt">
    <div class="container">
      <h2 class="section-title center">FAQ</h2>
      <div class="faq">
        <details>
          <summary>Why don’t I see any events?</summary>
          <p class="muted">Make sure the calendar is public and your view is set correctly. Try switching to the Agenda
            view above. If issues persist, open the full calendar via the “Open in Google Calendar” button.</p>
        </details>
        <details>
          <summary>How do I add this calendar to my phone?</summary>
          <p class="muted">Tap “Add to My Calendar” above. On iPhone, you can also subscribe to the
            <a href="https://calendar.google.com/calendar/ical/3829b628fb7826ae1317e90d0ceb01a699861ca1339348da612a20174cca3db7%40group.calendar.google.com/public/basic.ics"
              target="_blank" rel="noopener">.ics feed</a>.
          </p>
        </details>
        <details>
          <summary>Who can attend MSA events?</summary>
          <p class="muted">Everyone is welcome! Most events are open to all students and community members unless
            otherwise noted.</p>
        </details>
      </div>
    </div>
  </section>

  <!-- CONTACT / FOLLOW -->
  <section id="contact" class="section center">
    <div class="container">
      <h2 class="section-title">Questions or want to get involved?</h2>
      <p class="muted tiny">Reach out using the links below.</p>
      <div class="contact-links"
        style="margin-top:12px; display:flex; gap:12px; justify-content:center; flex-wrap:wrap;">
        <a class="btn btn-primary" href="https://www.instagram.com/msaatuta/" target="_blank"><i
            class="fab fa-instagram"></i> Instagram</a>
        <a class="btn btn-ghost" href="https://linktr.ee/utamsa" target="_blank"><i class="fas fa-link"></i>
          Linktree</a>
        <a class="btn btn-ghost" href="mailto:utarlington.msa@gmail.com"><i class="fas fa-envelope"></i> Email Us</a>
        <a class="btn btn-ghost" href="https://chat.whatsapp.com/HQmjAMqPr8X6bpYwAs5oxD" target="_blank"><i
            class="fab fa-whatsapp"></i> Brothers WhatsApp</a>
        <a class="btn btn-ghost" href="https://chat.whatsapp.com/JZk121BlGr6D0RMQuZ48Sz" target="_blank"><i
            class="fab fa-whatsapp"></i> Sisters WhatsApp</a>
      </div>
    </div>
  </section>

  <!-- Footer fragment -->
  <div data-include="./fragments/footer.html"></div>

  <!-- Fragment loader -->
  <script>
    (async () => {
      const tasks = [...document.querySelectorAll('[data-include]')].map(async el => {
        const file = el.getAttribute('data-include');
        const url = new URL(file, window.location.href).href;
        try {
          const res = await fetch(url, { cache: 'no-store' });
          if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
          el.outerHTML = await res.text();
        } catch (e) {
          el.outerHTML = `<!-- include failed: ${file} (${e}) -->`;
        }
      });
      await Promise.all(tasks);
      document.dispatchEvent(new Event('fragments:ready'));
    })();
  </script>

  <!-- Calendar view toggle logic -->
  <script>
    const CAL_ID = "3829b628fb7826ae1317e90d0ceb01a699861ca1339348da612a20174cca3db7@group.calendar.google.com";
    const BASE = new URL("https://calendar.google.com/calendar/embed");
    BASE.searchParams.set("src", CAL_ID);
    BASE.searchParams.set("ctz", "America/Chicago");
    BASE.searchParams.set("showTitle", "0");
    BASE.searchParams.set("showTabs", "0");
    BASE.searchParams.set("showPrint", "0");
    BASE.searchParams.set("showCalendars", "0");

    const frame = document.getElementById("gcal-frame");

    function setMode(mode) {
      const u = new URL(BASE);
      u.searchParams.set("mode", mode);
      frame.src = u.toString();
      document.querySelectorAll(".toggle-btn").forEach(b => {
        const on = b.dataset.mode === mode;
        b.classList.toggle("active", on);
        b.setAttribute("aria-selected", on ? "true" : "false");
      });
    }

    const defaultMode = matchMedia("(max-width: 640px)").matches ? "AGENDA" : "MONTH";
    setMode(defaultMode);

    document.querySelectorAll(".toggle-btn").forEach(b =>
      b.addEventListener("click", () => setMode(b.dataset.mode))
    );
  </script>


  <script>
    // Wait for DOM to be fully loaded before attaching RSVP button listeners
    document.addEventListener("DOMContentLoaded", () => {
      console.log("DOM loaded, setting up RSVP buttons...");
      const rsvpButtons = document.querySelectorAll(".rsvp-btn");
      console.log("Found RSVP buttons:", rsvpButtons.length);
      
      if (rsvpButtons.length === 0) {
        console.error("NO RSVP BUTTONS FOUND! Check HTML structure.");
        return;
      }
      
      rsvpButtons.forEach((btn, index) => {
        console.log(`Setting up RSVP button ${index + 1}:`, btn.textContent);
        
        // Handle both click and touch events for better mobile support
        const handleToggle = (e) => {
          e.preventDefault();
          e.stopPropagation();
          console.log(`RSVP button ${index + 1} clicked!`);
          console.log('Is mobile:', /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));
          
          const form = btn.parentElement.querySelector(".rsvp-form");
          if (form) {
            const wasHidden = form.classList.contains("hidden");
            form.classList.toggle("hidden");
            const isNowHidden = form.classList.contains("hidden");
            
            console.log(`Form ${index + 1} was hidden: ${wasHidden}, now hidden: ${isNowHidden}`);
            console.log(`Form ${index + 1} computed style:`, window.getComputedStyle(form).display);
            
            // Mobile-specific fix: Force CustomGForm reload if no content
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (isMobile && !isNowHidden) {
              const customFormDiv = form.querySelector('[data-customgform]');
              if (customFormDiv && customFormDiv.innerHTML.trim() === '') {
                console.log(`Mobile: Form ${index + 1} has no content, forcing reload...`);
                const formId = customFormDiv.getAttribute('data-customgform');
                // Force reload by recreating the element
                customFormDiv.innerHTML = '';
                customFormDiv.setAttribute('data-customgform', formId);
                
                // Trigger CustomGForm to process this element
                if (window.customgform) {
                  window.customgform.init();
                }
              }
            }
            
            btn.textContent = isNowHidden ? "RSVP Now" : "Hide Form";
            console.log(`Toggled form visibility for button ${index + 1}. Form hidden:`, isNowHidden);
          } else {
            console.error(`Could not find RSVP form for button ${index + 1}`);
          }
        };
        
        // Add both click and touchstart events
        btn.addEventListener("click", handleToggle);
        btn.addEventListener("touchstart", handleToggle, { passive: false });
        
        // Ensure button is properly styled for touch
        btn.style.cursor = "pointer";
        btn.style.touchAction = "manipulation";
        
        console.log(`RSVP button ${index + 1} setup complete`);
      });
      
      console.log("All RSVP buttons setup complete!");
    });
  </script>

  <script async src="https://cdn.customgform.com/cgf.js"></script>
  
  <!-- Debug CustomGForm loading -->
  <script>
    window.addEventListener('load', () => {
      console.log('CustomGForm script loaded:', typeof window.customgform !== 'undefined');
      console.log('User agent:', navigator.userAgent);
      console.log('Is mobile:', /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));
      
      // Check if forms are being processed
      setTimeout(() => {
        const forms = document.querySelectorAll('[data-customgform]');
        console.log('Found CustomGForm elements:', forms.length);
        forms.forEach((form, index) => {
          console.log(`Form ${index + 1}:`, form.getAttribute('data-customgform'));
          console.log(`Form ${index + 1} has content:`, form.innerHTML.length > 0);
          console.log(`Form ${index + 1} innerHTML:`, form.innerHTML);
        });
        
        // Check for any CustomGForm iframes that might have loaded
        const iframes = document.querySelectorAll('iframe[src*="customgform"]');
        console.log('CustomGForm iframes found:', iframes.length);
        
        // Force reload CustomGForm on mobile if no content
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        if (isMobile && forms.length > 0) {
          const hasContent = Array.from(forms).some(form => form.innerHTML.length > 0);
          if (!hasContent) {
            console.log('Mobile detected with no form content, attempting to reload CustomGForm...');
            // Try to reload the CustomGForm script
            const script = document.createElement('script');
            script.src = 'https://cdn.customgform.com/cgf.js';
            script.async = true;
            document.head.appendChild(script);
          }
        }
      }, 3000);
    });
  </script>


  <!-- Navbar JS after fragments -->
  <script src="../script/navBar.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const grid = document.querySelector(".upcoming-grid");
      if (grid) {
        const eventCards = grid.querySelectorAll(".event-card");
        const cardCount = eventCards.length;
        
        // Remove any existing classes
        grid.classList.remove("four-items", "more-items");
        
        // Apply appropriate class based on event count
        if (cardCount <= 4) {
          grid.classList.add("four-items");
        } else {
          grid.classList.add("more-items");
        }
      }
    });
  </script>

</body>

</html>